# 快速发布指南

## 最简单的发布方法

### 步骤 1: 确保本地 registry 运行

```bash
# 启动 Verdaccio（在另一个终端）
verdaccio
```

### 步骤 2: 构建包

```bash
# 在项目根目录执行
cd /Users/gjf/Desktop/project/jcyd-34/yd-component-design/yd-ai-monerepo
pnpm build
```

### 步骤 3: 发布包

```bash
# 发布所有变更的包（会自动更新版本）
pnpm publish

# 或者使用
pnpm exec lerna publish
```

## 发布特定包

### 方法 A: 手动更新版本后发布

```bash
# 1. 编辑包的 package.json，更新版本号
# 例如：packages/yd-hooks/package.json
# 将 "version": "1.0.0" 改为 "1.0.1"

# 2. 构建该包
pnpm --filter @yd-hooks/core build

# 3. 发布（只发布已更新版本的包）
pnpm exec lerna publish from-package
```

### 方法 B: 使用 Lerna version 更新版本

```bash
# 1. 更新特定包的版本
pnpm exec lerna version patch --force-publish=@yd-hooks/core

# 2. 构建
pnpm build

# 3. 发布
pnpm exec lerna publish from-package
```

## 完整发布流程示例

```bash
# 1. 进入项目目录
cd /Users/gjf/Desktop/project/jcyd-34/yd-component-design/yd-ai-monerepo

# 2. 查看变更的包
pnpm changed

# 3. 构建所有包
pnpm build

# 4. 发布（Lerna 会自动处理版本和发布）
pnpm publish
```

## Git 检查

**注意**: 如果遇到 `ERR_PNPM_GIT_UNCLEAN` 错误，说明 Git 工作目录不干净。

已配置 `gitChecks: false`，所以不会检查 Git 状态。如果需要启用 Git 检查：

1. 提交所有更改：`git add . && git commit -m "chore: update"`
2. 或者使用命令：`pnpm exec lerna publish --no-git-checks`

## 常用命令

```bash
# 查看所有包
pnpm exec lerna list

# 查看变更的包
pnpm changed

# 查看包差异
pnpm diff

# 构建所有包
pnpm build

# 发布所有变更的包
pnpm publish

# 发布 canary 版本
pnpm publish:canary
```

## 注意事项

1. **Lerna 8.x 不支持 `--scope`**: 不能直接指定发布特定包
2. **版本管理**: 使用 `independent` 模式，每个包独立版本
3. **Registry**: 已配置为 `http://localhost:4873/`
4. **构建**: 发布前必须先构建（`pnpm build`）

## 验证发布

发布后访问 `http://localhost:4873/` 查看已发布的包。

